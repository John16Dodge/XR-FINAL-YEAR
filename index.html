<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Interactive To-Do List</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #1f2937 0%, #374151 100%);
      color: #e5e7eb;
      transition: background 0.5s ease, color 0.3s ease;
      min-height: 120vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      position: relative;
      overflow-x: hidden;
      overflow-y: auto;
    }

    body.light-mode {
      background: linear-gradient(135deg, #f0f4f8 0%, #d9e2ec 100%);
      color: #2d3748;
    }

    .background {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      opacity: 0.5;
      background: linear-gradient(45deg, #1e3a8a, #2f855a, #374151, #1e3a8a);
      background-size: 400%;
      animation: gradientWave 15s ease infinite;
    }

    body.light-mode .background {
      background: linear-gradient(45deg, #a5b4fc, #60a5fa, #8b5cf6, #a5b4fc);
    }

    @keyframes gradientWave {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    @media (prefers-reduced-motion: reduce) {
      .background {
        animation: none;
        background: linear-gradient(135deg, #1f2937 0%, #374151 100%);
      }
      body.light-mode .background {
        background: linear-gradient(135deg, #f0f4f8 0%, #d9e2ec 100%);
      }
    }

    .container {
      width: 90%;
      max-width: 800px;
      margin: 100px auto;
      padding: 40px;
      background: #374151;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      transition: background 0.3s ease, transform 0.3s ease;
      position: relative;
      z-index: 1;
      min-height: 600px;
    }

    body.light-mode .container {
      background: #ffffff;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
    }

    h1 {
      font-size: 2.5em;
      margin-bottom: 30px;
      font-weight: 700;
      text-align: center;
      background: linear-gradient(to right, #60a5fa, #34d399);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    body.light-mode h1 {
      background: linear-gradient(to right, #1a73e8, #34d399);
    }

    .input-group {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-bottom: 30px;
    }

    .input-row {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }

    .phone-container {
      position: relative;
      flex: 1;
      min-width: 0;
    }

    .phone-error {
      color: #ff9b8e;
      font-size: 0.95em;
      margin-top: 5px;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    body.light-mode .phone-error {
      color: #ff6f61;
    }

    .phone-error.show {
      opacity: 1;
    }

    .filter-group {
      display: flex;
      gap: 15px;
      margin-bottom: 30px;
      justify-content: center;
    }

    input, select, textarea {
      padding: 14px;
      font-size: 1.1em;
      border: 2px solid #6b7280;
      border-radius: 8px;
      background: #4b5563;
      color: #e5e7eb;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
      line-height: 1.5;
    }

    body.light-mode input,
    body.light-mode select,
    body.light-mode textarea {
      background: #ffffff;
      border-color: #e2e8f0;
      color: #2d3748;
    }

    input[type="text"], textarea, input[type="tel"] {
      flex: 1;
      min-width: 0;
    }

    select, input[type="datetime-local"] {
      width: 180px;
    }

    textarea {
      resize: vertical;
      min-height: 60px;
      max-height: 150px;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #60a5fa;
      box-shadow: 0 0 8px rgba(96, 165, 250, 0.3);
    }

    body.light-mode input:focus,
    body.light-mode select:focus,
    body.light-mode textarea:focus {
      border-color: #1a73e8;
      box-shadow: 0 0 8px rgba(26, 115, 232, 0.3);
    }

    button {
      padding: 16px 28px;
      font-size: 1.1em;
      font-weight: 600;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
    }

    #add-task-btn {
      background: linear-gradient(to right, #60a5fa, #2563eb);
      color: white;
    }

    body.light-mode #add-task-btn {
      background: linear-gradient(to right, #1a73e8, #2563eb);
    }

    #add-task-btn:hover {
      background: linear-gradient(to right, #2563eb, #60a5fa);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(96, 165, 250, 0.4);
    }

    body.light-mode #add-task-btn:hover {
      box-shadow: 0 4px 12px rgba(26, 115, 232, 0.4);
    }

    ul {
      list-style-type: none;
      margin-top: 20px;
      min-height: 200px;
    }

    li {
      background: #4b5563;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 8px;
      font-size: 1.3em;
      display: flex;
      align-items: center;
      gap: 15px;
      transition: transform 0.3s ease, background 0.3s ease, opacity 0.3s ease;
      cursor: pointer;
      position: relative;
      flex-wrap: wrap;
      line-height: 1.5;
      animation: slideIn 0.3s ease forwards;
    }

    body.light-mode li {
      background: #f7fafc;
    }

    li.low-priority {
      border-left: 4px solid #22c55e;
    }

    li.medium-priority {
      border-left: 4px solid #f59e0b;
    }

    li.high-priority {
      border-left: 4px solid #ef4444;
    }

    li.completed {
      background: #2f855a;
      color: white;
      text-decoration: line-through;
      opacity: 0.9;
    }

    body.light-mode li.completed {
      background: #8b5cf6;
    }

    li.completed::before {
      content: 'âœ”';
      color: white;
      font-weight: bold;
    }

    li:hover {
      transform: translateX(10px);
      background: #6b7280;
    }

    body.light-mode li:hover {
      background: #fef3c7;
    }

    .category-tag, .duration-tag, .due-date-tag, .subtasks-btn, .percentage-tag {
      background: #6b7280;
      color: #e5e7eb;
      padding: 6px 10px;
      border-radius: 4px;
      font-size: 0.95em;
      margin: 0 6px;
      cursor: default;
    }

    body.light-mode .category-tag,
    body.light-mode .duration-tag,
    body-light-mode .due-date-tag,
    body.light-mode .percentage-tag {
      background: #e2e8f0;
      color: #4b5563;
    }

    .category-tag {
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .category-tag:hover {
      transform: scale(1.1);
    }

    .category-tag.work {
      background: #83c5be;
      color: white;
    }

    .category-tag.study {
      background: #ff9b8e;
      color: white;
    }

    .category-tag.personal {
      background: #ffd60a;
      color: #2d3748;
    }

    .category-tag.other {
      background: #9ca3af;
      color: white;
    }

    body.light-mode .category-tag.work {
      background: #006d77;
    }

    body.light-mode .category-tag.study {
      background: #ff6f61;
    }

    body.light-mode .category-tag.personal {
      background: #e8b923;
    }

    body.light-mode .category-tag.other {
      background: #6b7280;
    }

    .subtasks-btn {
      background: #4b5563;
      color: #d1d5db;
      cursor: pointer;
    }

    body.light-mode .subtasks-btn {
      background: #d1d5db;
      color: #1f2937;
    }

    .subtasks-btn:hover {
      background: #374151;
    }

    body.light-mode .subtasks-btn:hover {
      background: #9ca3af;
    }

    .percentage-tag {
      background: #4b5563;
    }

    body.light-mode .percentage-tag {
      background: #d1d5db;
    }

    .percentage-tag.complete {
      color: #22c55e;
    }

    .due-date-tag.overdue {
      background: #b91c1c;
      color: white;
    }

    .due-date-tag.today {
      background: #c2410c;
      color: white;
    }

    .due-date-tag.future {
      background: #15803d;
      color: white;
    }

    body.light-mode .due-date-tag.overdue {
      background: #ef4444;
    }

    body.light-mode .due-date-tag.today {
      background: #f59e0b;
    }

    body.light-mode .due-date-tag.future {
      background: #22c55e;
    }

    .subtasks-section {
      display: none;
      width: 100%;
      margin-top: 12px;
      padding: 12px;
      background: #4b5563;
      border: 1px solid #6b7280;
      border-radius: 4px;
      font-size: 1em;
      color: #e5e7eb;
      transition: all 0.3s ease;
    }

    body.light-mode .subtasks-section {
      background: #f1f5f9;
      border-color: #e2e8f0;
      color: #4b5563;
    }

    .subtasks-section.active {
      display: block;
      animation: slideDown 0.3s ease forwards;
    }

    .subtask-list {
      list-style-type: none;
      margin: 10px 0;
    }

    .subtask-list li {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 1em;
      padding: 10px;
      background: none;
      border: none;
      cursor: default;
      animation: none;
    }

    .subtask-list li.completed {
      text-decoration: line-through;
      color: #9ca3af;
      background: none;
      opacity: 1;
    }

    body.light-mode .subtask-list li.completed {
      color: #6b7280;
    }

    .subtask-list input[type="checkbox"] {
      cursor: pointer;
    }

    .add-subtask-input {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      border: 1px solid #6b7280;
      border-radius: 4px;
      font-size: 1em;
      background: #6b7280;
      color: #e5e7eb;
    }

    body.light-mode .add-subtask-input {
      background: #ffffff;
      border-color: #e2e8f0;
      color: #2d3748;
    }

    .delete-btn {
      background: #b91c1c;
      color: white;
      padding: 8px;
      font-size: 0.95em;
      border-radius: 4px;
      margin-left: auto;
      transition: background-color 0.3s ease, transform 0.2s ease;
    }

    body.light-mode .delete-btn {
      background: #ef4444;
    }

    .delete-btn:hover {
      background: #991b1b;
      transform: scale(1.1);
    }

    body.light-mode .delete-btn:hover {
      background: #dc2626;
    }

    #toggle-theme {
      background: linear-gradient(to right, #6b7280, #4b5563);
      color: white;
      margin-top: 30px;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    #toggle-theme:hover {
      background: linear-gradient(to right, #4b5563, #6b7280);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(107, 114, 128, 0.4);
    }

    #toggle-theme i {
      font-size: 1.2em;
      color: #ffffff;
    }

    body.light-mode #toggle-theme i {
      color: #2d3748;
    }

    @media (max-width: 600px) {
      .input-row {
        flex-direction: column;
        gap: 10px;
      }
      select, input[type="datetime-local"], input[type="tel"] {
        width: 100%;
      }
      button {
        width: 100%;
      }
      li {
        padding: 16px;
        font-size: 1.2em;
      }
      .container {
        margin: 50px auto;
        padding: 20px;
      }
    }

    @keyframes slideIn {
      from {
        transform: translateY(-20px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    @keyframes slideDown {
      from {
        transform: translateY(-10px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    @keyframes fade {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    li {
      animation: slideIn 0.3s ease forwards;
    }

    .category-tag, .percentage-tag {
      animation: fade 0.3s ease;
    }

    .error {
      border-color: #ef4444 !important;
      animation: shake 0.3s ease;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }
  </style>
</head>
<body class="dark-mode">
  <div class="background"></div>
  <div class="container">
    <h1>To-Do List</h1>
    <div class="input-group">
      <input type="text" id="task-input" placeholder="Add a new task">
      <textarea id="subtasks-input" placeholder="Add subtasks (comma-separated, optional)"></textarea>
      <div class="input-row">
        <select id="category-input">
          <option value="work">Work</option>
          <option value="study">Study</option>
          <option value="personal">Personal</option>
          <option value="other">Other</option>
        </select>
        <select id="priority-input">
          <option value="low">Low Priority</option>
          <option value="medium">Medium Priority</option>
          <option value="high">High Priority</option>
        </select>
        <select id="duration-input">
          <option value="15min">15 min</option>
          <option value="30min">30 min</option>
          <option value="1hr">1 hr</option>
          <option value="2hrs">2 hrs</option>
        </select>
        <input type="datetime-local" id="due-date-input">
        <div class="phone-container">
          <input type="tel" id="phone-input" placeholder="10-digit Mobile Number (e.g., 9876543210)">
          <span class="phone-error" id="phone-error"></span>
        </div>
      </div>
      <button id="add-task-btn">Add Task</button>
    </div>
    <div class="filter-group">
      <select id="filter-category">
        <option value="all">All Categories</option>
        <option value="work">Work</option>
        <option value="study">Study</option>
        <option value="personal">Personal</option>
        <option value="other">Other</option>
      </select>
    AFFIX
    </div>
    <ul id="task-list"></ul>
    <button id="toggle-theme">Switch to Light Mode</button>
  </div>

  <script>
    const taskInput = document.getElementById('task-input');
    const categoryInput = document.getElementById('category-input');
    const priorityInput = document.getElementById('priority-input');
    const durationInput = document.getElementById('duration-input');
    const dueDateInput = document.getElementById('due-date-input');
    const phoneInput = document.getElementById('phone-input');
    const phoneError = document.getElementById('phone-error');
    const subtasksInput = document.getElementById('subtasks-input');
    const addTaskBtn = document.getElementById('add-task-btn');
    const filterCategory = document.getElementById('filter-category');
    const taskList = document.getElementById('task-list');
    const toggleThemeBtn = document.getElementById('toggle-theme');

    // Update theme toggle button with icon
    function updateThemeToggleIcon(isDarkMode) {
      toggleThemeBtn.innerHTML = ''; // Clear existing content
      const icon = document.createElement('i');
      icon.classList.add('fas', isDarkMode ? 'fa-moon' : 'fa-sun');
      toggleThemeBtn.appendChild(icon);
      toggleThemeBtn.appendChild(document.createTextNode(isDarkMode ? ' Switch to Light Mode' : ' Switch to Dark Mode'));
    }

    // Show phone error message
    function showPhoneError(message) {
      phoneError.textContent = message;
      phoneError.classList.add('show');
      phoneInput.classList.add('error');
      setTimeout(() => {
        phoneError.classList.remove('show');
        phoneInput.classList.remove('error');
      }, 3000);
    }

    // Restrict phone input to digits and 10 characters
    phoneInput.addEventListener('input', () => {
      phoneInput.value = phoneInput.value.replace(/[^0-9]/g, '').slice(0, 10);
    });

    // Format date (e.g., "Apr 21, 2025, 3:00 PM")
    function formatDate(dateStr) {
      const date = new Date(dateStr);
      return date.toLocaleString('en-US', {
        month: 'short',
        day: 'numeric',
        year: 'numeric',
        hour: 'numeric',
        minute: '2-digit',
        hour12: true,
      });
    }

    // Calculate completion percentage
    function calculateCompletionPercentage(task) {
      if (task.completed) return 100;
      if (!task.subtasks || task.subtasks.length === 0) return 0;
      const completedCount = task.subtasks.filter(subtask => subtask.completed).length;
      return Math.round((completedCount / task.subtasks.length) * 100);
    }

    // Update percentage tag
    function updatePercentageTag(li, task) {
      let percentageTag = li.querySelector('.percentage-tag');
      if (!percentageTag) {
        percentageTag = document.createElement('span');
        percentageTag.classList.add('percentage-tag');
        li.insertBefore(percentageTag, li.querySelector('.subtasks-btn') || li.querySelector('.delete-btn'));
      }
      const percentage = calculateCompletionPercentage(task);
      percentageTag.textContent = `[${percentage}%]`;
      percentageTag.classList.toggle('complete', percentage === 100);
    }

    // Filter tasks by category
    function filterTasks() {
      const selectedCategory = filterCategory.value;
      const tasks = taskList.querySelectorAll('li');
      tasks.forEach(task => {
        const taskCategory = task.dataset.category;
        if (selectedCategory === 'all' || taskCategory === selectedCategory) {
          task.style.display = 'flex';
          task.style.animation = 'slideIn 0.3s ease forwards';
        } else {
          task.style.display = 'none';
        }
      });
    }

    // Load tasks and settings
    function loadTasks() {
      const tasks = JSON.parse(localStorage.getItem('tasks')) || [];
      tasks.forEach(task => {
        task.category = task.category || 'other';
        createTaskElement(task);
      });
      filterTasks();

      const phoneNumber = localStorage.getItem('phoneNumber');
      if (phoneNumber && phoneNumber.startsWith('+91')) {
        phoneInput.value = phoneNumber.slice(3); // Display without +91
      }

      // Load theme and set icon
      const theme = localStorage.getItem('theme') || 'dark';
      document.body.classList.remove('dark-mode', 'light-mode');
      document.body.classList.add(theme + '-mode');
      updateThemeToggleIcon(theme === 'dark');
    }

    // Create a task element
    function createTaskElement(task) {
      const li = document.createElement('li');
      const taskText = document.createElement('span');
      taskText.textContent = task.text;
      li.appendChild(taskText);

      // Category tag
      const categoryTag = document.createElement('span');
      categoryTag.textContent = `[${task.category.charAt(0).toUpperCase() + task.category.slice(1)}]`;
      categoryTag.classList.add('category-tag', task.category);
      categoryTag.addEventListener('click', (e) => {
        e.stopPropagation();
        filterCategory.value = task.category;
        filterTasks();
      });
      li.appendChild(categoryTag);

      // Duration tag
      const durationTag = document.createElement('span');
      durationTag.textContent = `[${task.duration}]`;
      durationTag.classList.add('duration-tag');
      li.appendChild(durationTag);

      // Due date tag
      if (task.dueDate) {
        const dueDateTag = document.createElement('span');
        dueDateTag.textContent = `[Due: ${formatDate(task.dueDate)}]`;
        dueDateTag.classList.add('due-date-tag');
        const now = new Date();
        const today = now.toISOString().split('T')[0];
        const taskDate = task.dueDate.split('T')[0];
        if (taskDate < today && !task.completed) {
          dueDateTag.classList.add('overdue');
        } else if (taskDate === today && !task.completed) {
          dueDateTag.classList.add('today');
        } else if (!task.completed) {
          dueDateTag.classList.add('future');
        }
        li.appendChild(dueDateTag);
      }

      // Percentage tag
      updatePercentageTag(li, task);

      // Subtasks button and section
      if (task.subtasks && task.subtasks.length > 0) {
        const subtasksBtn = document.createElement('span');
        subtasksBtn.textContent = 'Subtasks';
        subtasksBtn.classList.add('subtasks-btn');
        const subtasksSection = document.createElement('div');
        subtasksSection.classList.add('subtasks-section');

        const subtaskList = document.createElement('ul');
        subtaskList.classList.add('subtask-list');
        task.subtasks.forEach((subtask, index) => {
          const subtaskLi = createSubtaskElement(subtask, li, task);
          subtaskList.appendChild(subtaskLi);
        });

        const addSubtaskInput = document.createElement('input');
        addSubtaskInput.type = 'text';
        addSubtaskInput.classList.add('add-subtask-input');
        addSubtaskInput.placeholder = 'Add new subtask';
        addSubtaskInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter' && addSubtaskInput.value.trim()) {
            const newSubtask = { text: addSubtaskInput.value.trim(), completed: false };
            task.subtasks.push(newSubtask);
            const subtaskLi = createSubtaskElement(newSubtask, li, task);
            subtaskList.appendChild(subtaskLi);
            addSubtaskInput.value = '';
            updatePercentageTag(li, task);
            updateLocalStorage();
          }
        });

        subtasksSection.appendChild(subtaskList);
        subtasksSection.appendChild(addSubtaskInput);

        subtasksBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          subtasksSection.classList.toggle('active');
        });
        li.appendChild(subtasksBtn);
        li.appendChild(subtasksSection);
      }

      li.classList.add(`${task.priority}-priority`);
      if (task.completed) {
        li.classList.add('completed');
      }

      li.dataset.category = task.category;
      li.dataset.duration = task.duration;
      li.dataset.dueDate = task.dueDate || '';
      li.dataset.subtasks = JSON.stringify(task.subtasks || []);

      // Delete button
      const deleteBtn = document.createElement('button');
      deleteBtn.textContent = 'âœ•';
      deleteBtn.classList.add('delete-btn');
      deleteBtn.addEventListener('click', function (e) {
        e.stopPropagation();
        li.style.transform = 'translateX(100%)';
        li.style.opacity = '0';
        setTimeout(() => {
          li.remove();
          updateLocalStorage();
        }, 300);
      });

      li.appendChild(deleteBtn);

      li.addEventListener('click', function (e) {
        if (e.target !== deleteBtn && !e.target.classList.contains('category-tag') &&
            !e.target.classList.contains('duration-tag') && !e.target.classList.contains('due-date-tag') && 
            !e.target.classList.contains('subtasks-btn') && !e.target.classList.contains('percentage-tag') && 
            e.target.tagName !== 'INPUT') {
          li.classList.toggle('completed');
          task.completed = li.classList.contains('completed');
          updatePercentageTag(li, task);
          updateLocalStorage();
        }
      });

      li.addEventListener('dblclick', function () {
        li.style.transform = 'translateX(100%)';
        li.style.opacity = '0';
        setTimeout(() => {
          li.remove();
          updateLocalStorage();
        }, 300);
      });

      taskList.appendChild(li);
    }

    // Create a subtask element
    function createSubtaskElement(subtask, parentLi, parentTask) {
      const subtaskLi = document.createElement('li');
      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.checked = subtask.completed;
      checkbox.addEventListener('change', () => {
        subtask.completed = checkbox.checked;
        subtaskLi.classList.toggle('completed', subtask.completed);
        updatePercentageTag(parentLi, parentTask);
        updateLocalStorage();
      });

      const subtaskText = document.createElement('span');
      subtaskText.textContent = subtask.text;

      subtaskLi.appendChild(checkbox);
      subtaskLi.appendChild(subtaskText);
      if (subtask.completed) {
        subtaskLi.classList.add('completed');
      }

      return subtaskLi;
    }

    // Save tasks and settings
    function updateLocalStorage() {
      const tasks = [];
      taskList.querySelectorAll('li').forEach(li => {
        const task = {
          text: li.querySelector('span:not(.category-tag):not(.duration-tag):not(.due-date-tag):not(.subtasks-btn):not(.percentage-tag)').textContent,
          category: li.dataset.category,
          priority: li.classList.contains('low-priority') ? 'low' :
                    li.classList.contains('medium-priority') ? 'medium' : 'high',
          duration: li.dataset.duration,
          dueDate: li.dataset.dueDate,
          subtasks: JSON.parse(li.dataset.subtasks || '[]'),
          completed: li.classList.contains('completed')
        };
        tasks.push(task);
        updatePercentageTag(li, task);
      });
      localStorage.setItem('tasks', JSON.stringify(tasks));
      const phoneValue = phoneInput.value.trim();
      localStorage.setItem('phoneNumber', phoneValue ? `+91${phoneValue}` : '');
      localStorage.setItem('theme', document.body.classList.contains('light-mode') ? 'light' : 'dark');
    }

    // Validate phone number (10 digits)
    function validatePhoneNumber(phone) {
      const regex = /^\d{10}$/;
      return regex.test(phone);
    }

    addTaskBtn.addEventListener('click', function () {
      addTask();
    });

    taskInput.addEventListener('keypress', function (e) {
      if (e.key === 'Enter') {
        addTask();
      }
    });

    function addTask() {
      if (taskInput.value.trim() === "") {
        taskInput.classList.add('error');
        setTimeout(() => taskInput.classList.remove('error'), 300);
        return;
      }

      const phoneValue = phoneInput.value.trim();
      if (phoneValue && !validatePhoneNumber(phoneValue)) {
        showPhoneError('Please enter a valid 10-digit Indian mobile number');
        return;
      }

      const subtasks = subtasksInput.value.trim()
        .split(',')
        .map(s => s.trim())
        .filter(s => s)
        .map(s => ({ text: s, completed: false }));

      const task = {
        text: taskInput.value,
        category: categoryInput.value,
        priority: priorityInput.value,
        duration: durationInput.value,
        dueDate: dueDateInput.value || '',
        subtasks: subtasks,
        completed: false
      };

      createTaskElement(task);
      taskInput.value = '';
      dueDateInput.value = '';
      subtasksInput.value = '';
      updateLocalStorage();
      filterTasks();
    }

    filterCategory.addEventListener('change', filterTasks);

    toggleThemeBtn.addEventListener('click', function () {
      const isDarkMode = document.body.classList.contains('dark-mode');
      document.body.classList.toggle('dark-mode');
      document.body.classList.toggle('light-mode');
      updateThemeToggleIcon(!isDarkMode);
      updateLocalStorage();
    });

    window.addEventListener('load', loadTasks);
  </script>
</body>
</html>